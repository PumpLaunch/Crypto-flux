<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>CryptoFlux Pro</title>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <style>
        body {
            background: #0a0e27;
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            background: linear-gradient(135deg, #9945ff, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .btn {
            background: linear-gradient(135deg, #9945ff, #00ff88);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            font-size: 1rem;
        }
        .card {
            background: #131937;
            border: 1px solid #2a3457;
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        #status {
            margin-top: 1rem;
            font-family: monospace;
            color: #8892b0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">CryptoFlux Pro</div>
            <button id="connectBtn" class="btn">Connecter Wallet</button>
        </div>

        <div id="app" style="display:none;">
            <div class="card">
                <div><strong>Adresse :</strong> <span id="address"></span></div>
                <div><strong>Solde :</strong> <span id="balance"></span> SOL</div>
                <div><strong>Réseau :</strong> Mainnet</div>
            </div>
            <div class="card">
                <h3>Trading Automatique</h3>
                <button id="startScan" class="btn">Démarrer le Scan</button>
            </div>
        </div>

        <div id="status">Chargement de l'application...</div>
    </div>

    <script>
        const HELIUS_API_KEY = '1e8ea51d-3bed-4100-ad49-a6a7635c171a';
        const HELIUS_RPC_URL = `https://mainnet.helius-rpc.com/?api-key=${HELIUS_API_KEY}`;
        const statusEl = document.getElementById('status');
        const appEl = document.getElementById('app');
        const connectBtn = document.getElementById('connectBtn');
        const addressEl = document.getElementById('address');
        const balanceEl = document.getElementById('balance');

        let provider = null;
        let connection = null;

        function getInjectedProvider() {
            if (window.phantom?.solana?.isPhantom) return window.phantom.solana;
            if (window.solflare) return window.solflare;
            if (window.solana) return window.solana;
            return null;
        }

        async function connectWallet() {
            provider = getInjectedProvider();
            if (!provider) {
                statusEl.textContent = "❌ Aucun wallet Solana détecté.";
                alert("Installez Phantom ou utilisez cette page depuis son navigateur intégré.");
                return;
            }

            try {
                statusEl.textContent = "Connexion en cours...";
                const resp = await provider.connect();
                const pubKey = resp.publicKey.toString();

                connection = new solanaWeb3.Connection(HELIUS_RPC_URL, 'confirmed');
                const balanceLamports = await connection.getBalance(resp.publicKey);
                const balanceSol = balanceLamports / solanaWeb3.LAMPORTS_PER_SOL;

                addressEl.textContent = `${pubKey.slice(0,6)}...${pubKey.slice(-4)}`;
                balanceEl.textContent = balanceSol.toFixed(4);

                appEl.style.display = 'block';
                statusEl.textContent = "✅ Connecté !";
                statusEl.style.color = "#00ff88";

                // Écoute de la déconnexion
                if (provider.on) {
                    provider.on('disconnect', () => {
                        appEl.style.display = 'none';
                        statusEl.textContent = "Déconnecté";
                        statusEl.style.color = "#ff3366";
                    });
                }
            } catch (err) {
                console.error(err);
                statusEl.textContent = `❌ Erreur : ${err.message || 'Annulé'}`;
            }
        }

        connectBtn.addEventListener('click', connectWallet);

        document.getElementById('startScan').addEventListener('click', () => {
            alert("Scanner activé (simulation). En vrai, cela surveillerait Pump.fun !");
        });

        // Vérifie si déjà connecté (ex: reload)
        if (getInjectedProvider()) {
            statusEl.textContent = "Wallet détecté. Cliquez pour connecter.";
        } else {
            statusEl.textContent = "Ouvrez cette page dans l'app Phantom → Browser.";
        }
    </script>
</body>
</html>